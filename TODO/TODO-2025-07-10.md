# TODO - 2025-07-10

## ‚úÖ COMPLETED TODAY

### MiniKit Runtime Errors - FIXED
- **Issue**: `useMiniKit must be used within a MiniKitProvider` runtime errors
- **Root Cause**: Conditional MiniKitProvider was breaking `useMiniKit()` calls
- **Solution**: Always provide MiniKitProvider, never conditionally wrap
- **Result**: App loads without runtime errors on both desktop and mobile

### 401 Unauthorized Errors - RESOLVED
- **Issue**: `POST https://cca-lite.coinbase.com/metrics 401 (Unauthorized)`
- **Root Cause**: Expected behavior in desktop browsers, not actual errors
- **Solution**: Accept 401 errors as normal in desktop browsers
- **Result**: App works properly, 401 errors don't break functionality

### Mobile Navigation - WORKING
- **Issue**: Navigation not working properly on mobile
- **Solution**: Fixed MiniKit provider setup
- **Result**: Navigation working perfectly on mobile Mini App environment

### Documentation - UPDATED
- **Created**: `README/MINIKIT_TROUBLESHOOTING.md` - Comprehensive guide
- **Updated**: `BASE_AI_401_ERROR_QUESTION.md` - Added solution
- **Result**: Future MiniKit issues will be easier to resolve

## üö® URGENT - VERCEL ENVIRONMENT VARIABLES

### Critical Issue - Farcaster Manifest Broken
- **Status**: URGENT - Blocking production deployment
- **Issue**: New repo broke Farcaster manifest, needs revalidation
- **Impact**: Mini App won't work in Farcaster without proper manifest
- **Dependencies**: Environment variables must be set in Vercel first

### Required Actions
1. **Set Vercel Environment Variables** (URGENT)
   - `NEXT_PUBLIC_ONCHAINKIT_API_KEY`
   - `NEXT_PUBLIC_ONCHAINKIT_PROJECT_NAME`
   - `NEXT_PUBLIC_URL`
   - `FARCASTER_HEADER`, `FARCASTER_PAYLOAD`, `FARCASTER_SIGNATURE`

2. **Revalidate Farcaster Manifest**
   - Run `npx create-onchain --manifest` with custody wallet
   - Update environment variables with new credentials
   - Test manifest endpoint

3. **Verify Production Deployment**
   - Ensure all environment variables are loaded
   - Test `.well-known/farcaster.json` endpoint
   - Validate Mini App functionality in Farcaster

### üö® CHICKEN-AND-EGG PROBLEM - STEP-BY-STEP SOLUTION

#### **Phase 1: Basic Deployment (Can Do Now)**
- **Goal**: Get app deployed with working domain
- **Action**: Set basic environment variables in Vercel
  - `NEXT_PUBLIC_ONCHAINKIT_API_KEY` (you have this)
  - `NEXT_PUBLIC_ONCHAINKIT_PROJECT_NAME` = "CarCulture: CarMania Garage"
  - `NEXT_PUBLIC_URL` = will be your new Vercel domain
- **Result**: App deploys and gets working domain

#### **Phase 2: Manifest Preparation (After Deployment)**
- **Goal**: Update manifest with new domain
- **Action**: Update hardcoded domain in manifest route
- **Result**: Manifest accessible at new domain

#### **Phase 3: Farcaster Validation (After Domain Update)**
- **Goal**: Get Farcaster credentials
- **Action**: Use Farcaster Manifest Tool with new domain
  - Go to: https://farcaster.xyz/~/developers/mini-apps/manifest
  - Enter your new domain
  - Generate required credentials
- **Result**: Get `FARCASTER_HEADER`, `FARCASTER_PAYLOAD`, `FARCASTER_SIGNATURE`

#### **Phase 4: Complete Environment Setup (After Validation)**
- **Goal**: Full environment variable configuration
- **Action**: Add Farcaster credentials to Vercel
- **Result**: Complete environment variable setup

#### **Phase 5: Dynamic Manifest (Final Step)**
- **Goal**: Make manifest fully dynamic
- **Action**: Update manifest route to use environment variables
- **Result**: Manifest automatically adapts to environment changes

### üîë **Current Status:**
- ‚úÖ **Local Environment**: Working with .env file
- ‚ùå **Vercel Environment**: No variables set
- ‚ùå **Farcaster Manifest**: Broken, needs new domain
- ‚ùå **Production Deployment**: Cannot validate without manifest

## üîÑ CURRENT STATUS

### ‚úÖ Working
- MiniKit provider setup
- Navigation between pages
- Desktop and mobile environments
- Runtime error handling
- Context detection

### ‚ùå Broken
- Farcaster manifest (new repo issue)
- Vercel environment variables (not set)
- Production deployment (manifest validation failed)

### ‚è≥ Pending (Waiting for Discord)
- Button functionality in Mini App environment
- Discord team investigating button interaction issues

## üìã NEXT PRIORITIES

### 1. Fix Vercel Environment Variables (URGENT)
- **Status**: Blocking all production functionality
- **Action**: Set required environment variables in Vercel dashboard
- **Dependencies**: None - can be done immediately

### 2. Revalidate Farcaster Manifest (URGENT)
- **Status**: Required after environment variables are set
- **Action**: Run manifest generation with custody wallet
- **Dependencies**: Vercel environment variables must be set first

### 3. Button Functionality (High Priority)
- **Status**: Waiting for Discord team investigation
- **Action**: Monitor Discord for updates on button interaction
- **Dependencies**: Discord team response

### 4. MiniKit Version Update (Medium Priority)
- **Issue**: Deprecated `@farcaster/frame-sdk` warnings
- **Action**: Wait for MiniKit to update to `@farcaster/miniapp-sdk`
- **Impact**: Reduces console warnings, no functional impact

### 5. Additional Testing (Low Priority)
- **Action**: Test more edge cases and user flows
- **Focus**: Button interactions once Discord provides solution

## üéØ SUCCESS METRICS

‚úÖ **Runtime Errors**: 0 (Fixed)  
‚úÖ **Navigation**: Working on mobile  
‚úÖ **Desktop Compatibility**: Working with expected 401 errors  
‚úÖ **Documentation**: Comprehensive troubleshooting guide created  
‚ùå **Vercel Environment Variables**: Not set (URGENT)  
‚ùå **Farcaster Manifest**: Broken, needs revalidation (URGENT)  

## üìù NOTES

- **401 errors in desktop**: Expected behavior, not actual errors
- **MiniKit context false on desktop**: By design, not a bug
- **Deprecated SDK warnings**: Will be resolved in future MiniKit updates
- **Button functionality**: Separate issue being investigated by Discord team
- **Environment variables**: Local .env works, but Vercel has none set
- **Manifest revalidation**: Required after fixing environment variables

## üîó RESOURCES

- **Troubleshooting Guide**: `README/MINIKIT_TROUBLESHOOTING.md`
- **BASE AI Question**: `BASE_AI_401_ERROR_QUESTION.md`
- **Vercel Deployment**: Auto-deploys on push to main
- **Manifest Documentation**: `README/FC_MINIAPP_MANIFEST.md` 